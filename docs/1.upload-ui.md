# 音声アップロード UI 設計書

Batch Speech Transcription App

---

## 1. 概要

本ドキュメントは、ポートフォリオ用アプリ「音声ファイルのバッチ文字起こしアプリ」における音声アップロード UI（フロントエンド）の設計を定義する。

本 UI の目的:
- 複数音声ファイルの一括アップロード
- 文字起こしジョブの作成
- 後続のバッチ処理（Durable Functions 等）との疎結合な接続
- 音声ファイルを Azure Blob Storage に保存する導線を提供する

---

## 2. スコープ

### 2.1 対象範囲（v1）

- 音声ファイル選択（Drag & Drop / File Picker）
- クライアントサイドバリデーション
- Azure Blob Storage へのアップロード（SAS URL 経由）
- ジョブ作成
- ジョブステータスの簡易表示

### 2.2 対象外（v2 以降）

- 文字起こし結果の詳細表示・編集
- 話者分離・タイムコード表示
- 認証・認可（Azure AD 等）

---

## 3. 技術選定（フロントエンド）

| 項目 | 技術 |
| --- | --- |
| フレームワーク | Next.js（App Router） |
| 言語 | TypeScript |
| UI | Tailwind CSS |
| 状態管理 | React Hooks（useState / useReducer） |
| API 通信 | Fetch API |
| ファイルアップロード | multipart/form-data |
| 実行環境 | Vercel / Azure Static Web Apps |
| ストレージ | Azure Blob Storage |
| DB | Azure Cosmos DB（バックエンド） |

---

## 4. 画面一覧

| 画面 ID | 画面名 | 説明 |
| --- | --- | --- |
| U-01 | 音声アップロード画面 | メイン画面 |
| U-02 | ジョブ一覧画面（簡易） | 作成済みジョブの確認 |

---

## 5. 画面詳細設計

### 5.1 U-01 音声アップロード画面

#### 画面構成（概念）

```
Batch Speech Transcription

[ Drag & Drop Area ]
またはクリックして音声ファイルを選択

対応形式: mp3 / wav / m4a
最大: 50 ファイル / 合計 1GB

選択済みファイル一覧
- meeting_01.wav (12MB)
- meeting_02.wav (30MB)

[ アップロードしてジョブ作成 ]
```

#### UI 要素一覧

| ID | 種別 | 説明 |
| --- | --- | --- |
| fileDropZone | Drag & Drop | 複数音声ファイル選択 |
| fileInput | input[type=file] | フォールバック |
| fileList | List | 選択済みファイル一覧 |
| submitButton | Button | ジョブ作成 |
| errorMessage | Alert | バリデーションエラー表示 |

#### バリデーション仕様

| 項目 | 条件 |
| --- | --- |
| ファイル形式 | audio/* |
| 拡張子 | mp3 / wav / m4a |
| 最大ファイル数 | 50 |
| 最大合計サイズ | 1GB |
| ファイル未選択 | NG |

### 5.2 U-02 ジョブ一覧画面（簡易）

```
Jobs

JobId | Status | CreatedAt
xxx-123 | Uploaded | 10:21
yyy-456 | Processing | 10:45
```

---

## 6. コンポーネント設計

### 6.1 ディレクトリ構成

```
/app
└─ upload
   ├─ page.tsx
   ├─ UploadForm.tsx
   ├─ FileDropZone.tsx
   ├─ FileList.tsx
   └─ useUpload.ts
```

### 6.2 コンポーネント責務

| コンポーネント | 責務 |
| --- | --- |
| page.tsx | 画面ルート |
| UploadForm | 全体制御 |
| FileDropZone | ファイル選択 |
| FileList | ファイル一覧表示 |
| useUpload | 状態管理・API 通信 |

---

## 7. API インターフェース設計（UI 視点）

### 7.1 アップロード URL 発行 API（SAS）

**エンドポイント**  
`POST /api/uploads/sas`

**リクエスト**
- files: { name: string, size: number, type: string }[]

**レスポンス例**
- uploads: { fileName: string, uploadUrl: string, blobUrl: string }[]

### 7.2 ジョブ作成 API

**エンドポイント**  
`POST /api/jobs`

**リクエスト**
- audioFiles: { fileName: string, blobUrl: string }[]

**レスポンス**
- jobId: UUID
- status: Uploaded

### 7.3 ジョブ一覧取得 API

**エンドポイント**  
`GET /api/jobs`

**レスポンス例**
- jobId: UUID
- status: Processing
- createdAt: ISO-8601 datetime
- source: Azure Cosmos DB

---

## 8. UI 状態遷移

```
Idle
↓
FilesSelected
↓
UploadingToBlob
↓
JobCreated
↓
Processing → Completed
```

---

## 9. エラーハンドリング

| ケース | 表示方法 |
| --- | --- |
| バリデーションエラー | インライン表示 |
| 通信失敗 | Toast |
| サーバーエラー | モーダル |
| Blob 署名 URL 期限切れ | 再取得誘導 |

---

## 10. 拡張予定（v2）

- アップロード進捗バー
- 認証（Azure AD）
- ジョブ詳細画面
